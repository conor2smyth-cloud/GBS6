<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard | GBS Bartending</title>
  <link rel="icon" href="Logo.png" />
  <link rel="stylesheet" href="style.css" />
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--ink);
      font-size: 0.95rem;
      margin-top: 10px;
    }
    th, td {
      border-bottom: 1px solid #2b2b2b;
      padding: 8px;
    }
    th {
      text-align: left;
      color: var(--gold);
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 6px;
      background: #111;
      border: 1px solid #333;
      color: #fff;
      border-radius: 6px;
    }
    .admin-sections {
      display: grid;
      grid-template-columns: 1fr;
      gap: 28px;
      margin-top: 20px;
    }
    @media (min-width: 900px) {
      .admin-sections {
        grid-template-columns: 1fr 1fr;
      }
    }
    .todo-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(20, 20, 20, 0.85);
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #2b2b2b;
      margin-bottom: 6px;
      opacity: 1;
      transition: opacity 0.4s ease, transform 0.3s ease;
    }
    .todo-item.fade-out {
      opacity: 0;
      transform: translateY(-6px);
    }
    .todo-item.fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(5px);}
      to {opacity: 1; transform: translateY(0);}
    }
    .calendar {
      background: rgba(20, 20, 20, 0.8);
      padding: 16px;
      border: 1px solid #2b2b2b;
      border-radius: 16px;
    }
    .calendar h3 {
      text-align: center;
      color: var(--gold);
      margin-bottom: 10px;
    }
    .toast {
      display: none;
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: rgba(255, 255, 255, 0.15);
      color: var(--ink);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      animation: fadeInOut 2.5s ease;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(10px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(10px); }
    }
  </style>
</head>

<body onload="adminInit(); pettyInit(); loadTodo(); loadCalendar();">
  <header class="header">
    <div class="bar">
      <div class="nav">
        <a href="index.html">Home</a>
        <a href="tonight.html">Tonight</a>
      </div>
      <img class="logo-small" src="Logo.png" alt="GBS logo" />
      <div class="nav">
        <a href="#" onclick="adminLogout(); return false;">Logout</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="banner" style="background:url('https://images.unsplash.com/photo-1528698827591-e19ccd7bc23d?auto=format&fit=crop&w=1500&q=60') center/cover no-repeat;">
      <h1>Admin Dashboard</h1>
      <div class="now">Manage Events â€¢ Track Cash â€¢ Stay Organised</div>
    </section>

    <div class="admin-sections">
      <!-- Petty Cash Tracker -->
      <div class="box">
        <h2>Petty Cash Tracker</h2>
        <table id="pettyTable">
          <thead>
            <tr>
              <th>Item</th>
              <th>Amount</th>
              <th>Price (â‚¬)</th>
              <th>Staff</th>
              <th>Paid</th>
            </tr>
          </thead>
          <tbody id="pettyBody"></tbody>
        </table>
        <button class="button" onclick="addPettyRow()">+ Add Row</button>
        <button class="button" onclick="pettySave()">ðŸ’¾ Save</button>
        <p style="text-align:right;margin-top:8px;">
          <strong>Total:</strong> â‚¬<span id="pettyTotal">0.00</span>
        </p>
      </div>

      <!-- To-Do List -->
      <div class="box">
        <h2>To-Do List</h2>
        <div id="todoList"></div>
        <input type="text" id="newTodo" placeholder="Add a new task..." />
        <button class="button" onclick="addTodo()">+ Add Task</button>

        <h3 style="margin-top:20px;color:var(--gold);">Completed Tasks</h3>
        <div id="completedTasks"></div>
      </div>

      <!-- Upcoming Events -->
      <div class="box calendar" style="grid-column:1 / -1;">
        <h3>Upcoming Events</h3>
        <table id="eventTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Date</th>
              <th>Event</th>
              <th>Host</th>
              <th>Numbers</th>
              <th>Staff</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody id="eventList"></tbody>
        </table>
      </div>
    </div>
  </main>

  <div id="toast" class="toast">âœ… Task Completed</div>

  <script src="app.js"></script>

  <script>
    /* --- Petty Cash Table --- */
    function pettyInit() {
      const data = JSON.parse(localStorage.getItem("gbs_petty") || "[]");
      const body = document.getElementById("pettyBody");
      body.innerHTML = "";
      data.forEach(addPettyRow);
      pettyTotal();
    }

    function addPettyRow(r = {}) {
      const body = document.getElementById("pettyBody");
      const tr = document.createElement("tr");

      ["item", "amount", "price", "staff"].forEach((k) => {
        const td = document.createElement("td");
        const i = document.createElement("input");
        i.type = k === "amount" || k === "price" ? "number" : "text";
        i.value = r[k] || "";
        i.oninput = pettyTotal;
        td.appendChild(i);
        tr.appendChild(td);
      });

      const tdPaid = document.createElement("td");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = r.paid || false;
      tdPaid.appendChild(cb);
      tr.appendChild(tdPaid);
      body.appendChild(tr);
    }

    function pettySave() {
      const rows = [...document.querySelectorAll("#pettyBody tr")];
      const data = rows.map((tr) => {
        const [i, a, p, s] = [...tr.querySelectorAll("input[type='text'], input[type='number']")].map((x) => x.value);
        const paid = tr.querySelector("input[type='checkbox']").checked;
        return { item: i, amount: a, price: p, staff: s, paid };
      });
      localStorage.setItem("gbs_petty", JSON.stringify(data));
      pettyTotal(true);
    }

    function pettyTotal(show) {
      let total = 0;
      [...document.querySelectorAll("#pettyBody tr")].forEach((tr) => {
        const price = parseFloat(tr.querySelectorAll("input[type='number']")[1]?.value || "0");
        if (!isNaN(price)) total += price;
      });
      document.getElementById("pettyTotal").textContent = total.toFixed(2);
      if (show) showToast("ðŸ’¾ Petty Cash Saved");
    }

    /* --- To-Do List with Completed Section --- */
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(() => (toast.style.display = "none"), 2500);
    }

    function loadTodo() {
      const list = JSON.parse(localStorage.getItem("gbs_todo") || "[]");
      const done = JSON.parse(localStorage.getItem("gbs_done") || "[]");
      const todoDiv = document.getElementById("todoList");
      const completedDiv = document.getElementById("completedTasks");
      todoDiv.innerHTML = "";
      completedDiv.innerHTML = "";

      list.forEach((t, i) => {
        const div = document.createElement("div");
        div.className = "todo-item fade-in";

        const left = document.createElement("div");
        left.style.display = "flex";
        left.style.alignItems = "center";
        left.style.gap = "10px";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = t.done;
        cb.onchange = () => {
          t.done = cb.checked;
          if (cb.checked) {
            const completedAt = new Date().toLocaleString();
            done.push({ ...t, date: completedAt });
            localStorage.setItem("gbs_done", JSON.stringify(done));
            showToast("âœ… Task Completed");
          }
          list.splice(i, 1);
          localStorage.setItem("gbs_todo", JSON.stringify(list));
          loadTodo();
        };

        const span = document.createElement("span");
        span.textContent = t.text;
        if (t.done) span.style.textDecoration = "line-through";

        const del = document.createElement("button");
        del.textContent = "âŒ";
        del.className = "button small";
        del.onclick = () => {
          div.classList.add("fade-out");
          setTimeout(() => {
            list.splice(i, 1);
            localStorage.setItem("gbs_todo", JSON.stringify(list));
            loadTodo();
          }, 400);
        };

        left.appendChild(cb);
        left.appendChild(span);
        div.appendChild(left);
        div.appendChild(del);
        todoDiv.appendChild(div);
      });

      done.forEach((t) => {
        const div = document.createElement("div");
        div.className = "todo-item fade-in";
        const span = document.createElement("span");
        span.textContent = `${t.text}  â€”  âœ… ${t.date}`;
        span.style.color = "#888";
        div.appendChild(span);
        completedDiv.appendChild(div);
      });
    }

    function addTodo() {
      const input = document.getElementById("newTodo");
      const text = input.value.trim();
      if (!text) return;
      const list = JSON.parse(localStorage.getItem("gbs_todo") || "[]");
      list.push({ text, done: false });
      localStorage.setItem("gbs_todo", JSON.stringify(list));
      input.value = "";
      loadTodo();
    }

    /* --- Events Table --- */
    function loadCalendar() {
      const events = [
        { day: "Sat", date: "2025-10-12", event: "Joe & Ursula's Wedding", host: "Joe", numbers: "120", staff: "Gerry, Aaron", details: "Evening cocktails" },
        { day: "Fri", date: "2025-10-28", event: "Corporate Mixology Workshop", host: "Louth Business Network", numbers: "40", staff: "Lisa, Aaron", details: "Team-building" },
        { day: "Wed", date: "2025-11-05", event: "Winter Gala Night", host: "Town Hall", numbers: "300", staff: "Full Crew", details: "Formal bar setup" },
      ];
      const el = document.getElementById("eventList");
      el.innerHTML = "";
      events.forEach((e) => {
        const tr = document.createElement("tr");
        ["day", "date", "event", "host", "numbers", "staff", "details"].forEach((k) => {
          const td = document.createElement("td");
          td.textContent = e[k];
          tr.appendChild(td);
        });
        el.appendChild(tr);
      });
    }
  </script>
</body>
</html>
